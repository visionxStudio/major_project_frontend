<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    />
    <script src="https://unpkg.com/wavesurfer.js"></script>
    <link rel="stylesheet" href="components/stylesheets/page.css" />
    <title>Document</title>
  </head>

  <body>
    <div class="page">
      <div class="page-back">
        <i class="fa fa-arrow-left"></i>
        <span>Back</span>
      </div>
      <div class="page-container">
        <div class="page-left">
          <h1>Your previews are ready!</h1>
          <h2>You can change the stem separation type below</h2>
          <div class="page-left-text">
            <p>Vocal and Instrumental</p>
            <p>Vocal and Instrumental</p>
            <p>Vocal and Instrumental</p>
            <p>Vocal and Instrumental</p>
            <p>Vocal and Instrumental</p>
          </div>
        </div>
        <div class="page-right">
          <div class="page-right-header">
            <img src="play.png" alt="" id="playbtn" />
            <div id="duration">00:00</div>

            <div class="line"><span>/</span></div>
            <div id="last-duration"></div>
          </div>
          <div class="box-container">
            <div class="box">
              <div class="box-content">
                <div class="box-inside">
                  <img src="/drum.png" alt="" />
                  <span>Drums</span>
                </div>

                <div id="waveform">
                  <div id="point-duration"></div>
                </div>
              </div>
            </div>
          </div>
          <div class="volume-controller">
            <div class="volume">
              <div class="mike">
                <a href="" id="volume-icon"
                  ><img src="volume-mute.png" alt=""
                /></a>
              </div>
              <input
                type="range"
                class="range"
                value="0"
                min="0"
                max="100"
                id="volume"
              />
              <span id="pervalue">
                <div id="point-duration"></div>
              </span>
            </div>
          </div>
          <div class="box-container">
            <div class="box">
              <div class="box-content">
                <div class="box-inside">
                  <img src="/musical-note.png" alt="" />
                  <span>without Drums</span>
                </div>

                <div id="waveform">
                  <div id="point-duration"></div>
                </div>
              </div>
            </div>
          </div>
          <div class="volume-controller">
            <div class="volume">
              <div class="mike">
                <a href=""><img src="volume-mute.png" alt="" /></a>
              </div>
              <input type="range" class="range" value="0" min="0" max="100" />
              <span id="pervalue"></span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>
  <script>
    // Waveform script
    var playbtn = document.getElementById("playbtn");
    var currentElement = document.getElementById("duration");
    var durationElement = document.getElementById("last-duration");
    var volumeRange = document.getElementById("volume");
    var pointDurationElement = document.getElementById("point-duration");
    var waveformContainer = document.getElementById("waveform");
    var wavesurfer = WaveSurfer.create({
      container: "#waveform",
      waveColor: "#bbbabb",
      progressColor: "#f8d231",
      barWidth: 0.9,
      height: 50,
      partialRender: true,
    });
    // song can upload from here
    wavesurfer.load("music-1.mp3");

    // to make pont duration when cursor move and show dynamically
    wavesurfer.on("ready", function () {
      var durationInSeconds = wavesurfer.getDuration();

      waveformContainer.addEventListener("mousemove", function (event) {
        var containerRect = waveformContainer.getBoundingClientRect();
        var offsetX = event.clientX - containerRect.left;
        var progress = offsetX / containerRect.width;
        var currentTimeInSeconds = progress * durationInSeconds;
        var formattedCurrentTime = formatTime(currentTimeInSeconds);

        pointDurationElement.textContent = formattedCurrentTime;
        pointDurationElement.style.left = offsetX + "px";
      });

      waveformContainer.addEventListener("mouseenter", function () {
        pointDurationElement.style.visibility = "visible";
        pointDurationElement.style.opacity = 1;
      });

      waveformContainer.addEventListener("mouseleave", function () {
        pointDurationElement.style.visibility = "hidden";
        pointDurationElement.style.opacity = 0;
      });
    });

    //song play format according to the waveform
    wavesurfer.on("audioprocess", function () {
      var currentTimeInSeconds = wavesurfer.getCurrentTime();
      var formattedCurrentTime = formatTime(currentTimeInSeconds);
      currentElement.textContent = formattedCurrentTime;
    });
    // song duration time
    wavesurfer.on("ready", function () {
      var durationInSeconds = wavesurfer.getDuration();
      var formattedDuration = formatTime(durationInSeconds);
      durationElement.textContent = formattedDuration;
    });
    // play pause function
    playbtn.onclick = function () {
      wavesurfer.playPause();
      if (playbtn.src.includes("play.png")) {
        playbtn.src = "/pause.png";
      } else {
        playbtn.src = "/play.png";
      }
      wavesurfer.on("finish", function () {
        playbtn.src = "/play.png";
        wavesurfer.stop();
      });
    };
    // Set volume range value to 100 initially
    volumeRange.value = 100;
    // time format time function
    function formatTime(timeInSeconds) {
      var minutes = Math.floor(timeInSeconds / 60);
      var seconds = Math.floor(timeInSeconds % 60);
      var formattedTime = `${minutes.toString().padStart(2, "0")}:${seconds
        .toString()
        .padStart(2, "0")}`;
      return formattedTime;
    }
    // volume increase and decrease functionality
    var line = document.getElementById("volume");
    line.addEventListener("input", function () {
      var pervalue = document.getElementById("pervalue");
      var volumeIcon = document.getElementById("volume-icon");

      if (line.value == 0) {
        pervalue.innerHTML = "";
        volumeIcon.querySelector("img").src = "volume-mute.png";
        wavesurfer.setVolume(0);
      } else {
        pervalue.innerHTML = line.value;
        volumeIcon.querySelector("img").src = "unmute.png";
        var volume = line.value / 100;
        wavesurfer.setVolume(volume);
      }
    });
  </script>
</html>
